[SERVICE]
    Daemon Off
    Flush 1
    Log_Level info
    Parsers_File parsers.conf
    HTTP_Server On
    HTTP_Listen 0.0.0.0
    HTTP_Port 2020
    Health_Check On

# Input from Docker containers
[INPUT]
    Name forward
    Listen 0.0.0.0
    Port 24224
    Buffer_Chunk_Size 1M
    Buffer_Max_Size 6M

# Input from Docker logs (backend)
[INPUT]
    Name tail
    Path /var/lib/docker/containers/*dancesuite-backend*/*.log
    Parser docker
    Tag backend.*
    Refresh_Interval 5
    Mem_Buf_Limit 5MB
    Skip_Long_Lines On

# Input from Docker logs (frontend)
[INPUT]
    Name tail
    Path /var/lib/docker/containers/*dancesuite-frontend*/*.log
    Parser docker
    Tag frontend.*
    Refresh_Interval 5
    Mem_Buf_Limit 5MB
    Skip_Long_Lines On

# Parse JSON logs from backend
[FILTER]
    Name parser
    Match backend.*
    Key_Name log
    Parser json
    Reserve_Data On
    Preserve_Key On

# Add Kubernetes-style metadata
[FILTER]
    Name modify
    Match backend.*
    Add service backend
    Add environment production

[FILTER]
    Name modify
    Match frontend.*
    Add service frontend
    Add environment production

# Output to Elasticsearch
[OUTPUT]
    Name es
    Match backend.*
    Host elasticsearch
    Port 9200
    Index dancesuite-backend
    Type _doc
    Logstash_Format On
    Logstash_Prefix dancesuite-backend
    Retry_Limit 5
    Suppress_Type_Name On

[OUTPUT]
    Name es
    Match frontend.*
    Host elasticsearch
    Port 9200
    Index dancesuite-frontend
    Type _doc
    Logstash_Format On
    Logstash_Prefix dancesuite-frontend
    Retry_Limit 5
    Suppress_Type_Name On

# Output to stdout for debugging
[OUTPUT]
    Name stdout
    Match *
    Format json_lines
